{% extends "article/base.html" %}

{% load static %}

{% block title %}articles list{% endblock %}

{% block content %}
{% with total_likes=article.users_like.count users_like=article.users_like.all %}
<link href="{% static 'quill/quill.snow.css' %}" rel="stylesheet">
<div>
    <header>
        <h1>{{ article.title }}</h1>
        <p>{{ user.username }}</p>
        <span class="glyphicon glyphicon-thumbs-up">{{total_likes}} like{{total_likes|pluralize }}</span>
    </header>

    <link rel="stylesheet" href="{% static 'editor/css/editormd.preview.css' %}" />
    <div id='editormd-view'>
        <textarea id="append-test" style="display:none;">
{{ article.body }}
	    </textarea>
    </div>

    <!-- <div class="" id="qeditor">{{ article.body }}</div> -->
    <div>
        <p class="text-center">
            <a href="#" onclick="like_article({{article.id}},'like')">
                <span class="glyphicon glyphicon-thumbs-up">like</span>
            </a>
            <a href="#" onclick="like_article({{article.id}},'unlike')">
                <span class="glyphicon glyphicon-thumbs-down">unlike</span>
            </a>
        </p>
    </div>
    <div>
        <p class="text-center"><strong>liked users</strong></p>
        {% for user in article.users_like.all %}
            <p class="text-center">{{ user.username }}</p>
        {% empty %}
            <p class="text-center">nodoy liked yet</p>
        {% endfor %}
    </div>
</div>
<script src='{% static "js/jquery.js" %}'></script>
<script src='{% static "editor/lib/marked.min.js" %}'></script>
<script src='{% static "editor/lib/prettify.min.js" %}'></script>
<script src='{% static "editor/lib/raphael.min.js" %}'></script>
<script src='{% static "editor/lib/underscore.min.js" %}'></script>
<script src='{% static "editor/lib/sequence-diagram.min.js" %}'></script>
<script src='{% static "editor/lib/flowchart.min.js" %}''></script>
<script src='{% static "editor/lib/jquery.flowchart.min.js" %}'></script>
<script src='{% static "editor/editormd.js" %}'></script>
<script src="{% static 'quill/quill.js' %}"></script>

<script type="text/javascript">
$(function(){
	editormd.markdownToHTML("editormd-view", {
        htmlDecode      : "style,script,iframe",  // you can filter tags decode
        emoji           : true,
        taskList        : true,
        tex             : true,  // 默认不解析
        flowChart       : true,  // 默认不解析
        sequenceDiagram : true,  // 默认不解析
    });


});
function like_article(id,action){
    $.ajax({
        url:"{% url 'article:like-article' %}",
        type:"POST",
        data: {"id":id,"action":action},
        success:function(e){
            layer.msg(e.notice);
            window.location.relaod();
        },
    });
}
</script>
{% endwith %}
{% endblock %}
